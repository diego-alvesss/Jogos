<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Game</title>
    <style>
        body {
            background: #000;
            color: #00ff00;
            font-family: 'Press Start 2P', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .container {
            text-align: center;
        }
        canvas {
            background: #111;
            border: 4px solid #00ff00;
            box-shadow: 0 0 20px #00ff00;
            display: block;
            margin: 0 auto;
        }
        h1 {
            color: #00ff00;
            margin-bottom: 20px;
            font-size: 1.5em;
            text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00;
        }
        .stats {
            margin-bottom: 15px;
        }
        .btn-start {
            background: #000;
            color: #00ff00;
            border: 3px solid #00ff00;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            margin-top: 15px;
            font-family: 'Press Start 2P', monospace;
        }
        .btn-start:hover {
            background: rgba(0,255,0,0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SNAKE GAME</h1>
        <div class="stats">
            Pontuação: <span id="score">0</span>
        </div>
        <canvas id="gameCanvas" width="400" height="400"></canvas>
        <button class="btn-start" id="startBtn">INICIAR</button>
        <div style="margin-top:10px;font-size:0.8em;color:#00ff00;">Use as setas do teclado para controlar a cobra</div>
    </div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startBtn = document.getElementById('startBtn');
    let score = 0;
    let snake, direction, nextDirection, apple, gameRunning, speed, lastUpdate;
    const gridSize = 20;
    const tileCount = canvas.width / gridSize;

        function resetGame() {
            score = 0;
            // Cobra começa com 4 segmentos
            snake = [
                {x: 8, y: 10},
                {x: 7, y: 10},
                {x: 6, y: 10},
                {x: 5, y: 10}
            ];
            direction = 'right';
            nextDirection = 'right';
            apple = spawnApple();
            gameRunning = true;
            speed = 180; // mais lento no início
            lastUpdate = performance.now();
            document.getElementById('score').textContent = score;
        }

        function spawnApple() {
            let pos;
            do {
                pos = {
                    x: Math.floor(Math.random() * tileCount),
                    y: Math.floor(Math.random() * tileCount)
                };
            } while (snake.some(s => s.x === pos.x && s.y === pos.y));
            return pos;
        }

        // Permite dois cliques na maçã
        let appleClicks = 0;
        function drawApple() {
            const x = apple.x * gridSize + gridSize / 2;
            const y = apple.y * gridSize + gridSize / 2;
            ctx.save();
            ctx.beginPath();
            ctx.arc(x, y, gridSize / 2.2, 0, Math.PI * 2);
            ctx.fillStyle = 'red';
            ctx.shadowColor = '#ff3333';
            ctx.shadowBlur = 10;
            ctx.fill();
            ctx.shadowBlur = 0;
            ctx.beginPath();
            ctx.moveTo(x, y - gridSize / 2.2);
            ctx.lineTo(x + 4, y - gridSize / 1.5);
            ctx.lineTo(x - 4, y - gridSize / 1.5);
            ctx.closePath();
            ctx.fillStyle = '#33ff33';
            ctx.fill();
            ctx.restore();
        }

        // Detecta clique na maçã
        canvas.addEventListener('mousedown', function(e) {
            if (!gameRunning) return;
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            const appleX = apple.x * gridSize + gridSize / 2;
            const appleY = apple.y * gridSize + gridSize / 2;
            const dist = Math.sqrt(Math.pow(mouseX - appleX, 2) + Math.pow(mouseY - appleY, 2));
            if (dist < gridSize / 2.2) {
                appleClicks++;
                if (appleClicks <= 2) {
                    // Adiciona ponto e cresce a cobra
                    score++;
                    document.getElementById('score').textContent = score;
                    // Adiciona segmento na cabeça
                    const head = {x: snake[0].x, y: snake[0].y};
                    snake.unshift({...head});
                    // Se for o segundo clique, troca a maçã
                    if (appleClicks === 2) {
                        apple = spawnApple();
                        appleClicks = 0;
                    }
                }
            }
        });

        function drawSnake() {
            snake.forEach((segment, i) => {
                const x = segment.x * gridSize + gridSize / 2;
                const y = segment.y * gridSize + gridSize / 2;
                ctx.save();
                ctx.beginPath();
                ctx.arc(x, y, gridSize / 2.1, 0, Math.PI * 2);
                if (i === 0) {
                    // Cabeça com gradiente
                    const grad = ctx.createRadialGradient(x, y, gridSize/8, x, y, gridSize/2.1);
                    grad.addColorStop(0, '#bfff00');
                    grad.addColorStop(1, '#00ff00');
                    ctx.fillStyle = grad;
                    ctx.shadowColor = '#00ff00';
                    ctx.shadowBlur = 10;
                } else {
                    ctx.fillStyle = '#009900';
                }
                ctx.fill();
                ctx.restore();
            });
        }

        function draw() {
            ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            drawApple();
            drawSnake();
        }

        function update() {
            if (!gameRunning) return;
            const now = performance.now();
            if (now - lastUpdate < speed) {
                requestAnimationFrame(update);
                return;
            }
            lastUpdate = now;
            direction = nextDirection;
            const head = {x: snake[0].x, y: snake[0].y};
            if (direction === 'right') head.x++;
            else if (direction === 'left') head.x--;
            else if (direction === 'up') head.y--;
            else if (direction === 'down') head.y++;
            // Wall collision
            if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
                gameOver();
                return;
            }
            // Self collision
            if (snake.some(seg => seg.x === head.x && seg.y === head.y)) {
                gameOver();
                return;
            }
            snake.unshift(head);
            // Apple collision
            if (head.x === apple.x && head.y === apple.y) {
                // Só come se não foi clicada duas vezes
                if (appleClicks === 0) {
                    score++;
                    document.getElementById('score').textContent = score;
                    apple = spawnApple();
                    // Aumenta velocidade, mínimo 60ms
                    speed = Math.max(60, speed - 10);
                }
            } else {
                snake.pop();
            }
            draw();
            requestAnimationFrame(update);
        }

        function gameOver() {
            gameRunning = false;
            ctx.fillStyle = '#00ff00';
            ctx.font = '24px "Press Start 2P", monospace';
            ctx.textAlign = 'center';
            ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2);
        }

        document.addEventListener('keydown', e => {
            if (!gameRunning) return;
            if (e.key === 'ArrowUp' && direction !== 'down') nextDirection = 'up';
            else if (e.key === 'ArrowDown' && direction !== 'up') nextDirection = 'down';
            else if (e.key === 'ArrowLeft' && direction !== 'right') nextDirection = 'left';
            else if (e.key === 'ArrowRight' && direction !== 'left') nextDirection = 'right';
        });

        startBtn.addEventListener('click', () => {
            resetGame();
            draw();
            requestAnimationFrame(update);
        });

        draw();
    </script>
</body>
</html>
